From 26dca67b82fdb5cad896edfaeddc7aef612dc9b0 Mon Sep 17 00:00:00 2001
From: "lauren n. liberda" <lauren@selfisekai.rocks>
Date: Tue, 16 Apr 2024 21:31:30 +0200
Subject: [PATCH] libvpx: also disable SVE on gcc

arm_neon_sve_bridge.h is not available on gcc

Bug: 40565911
---
 third_party/libvpx/BUILD.gn                               | 4 ++--
 third_party/libvpx/source/config/linux/arm64/vpx_config.h | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/third_party/libvpx/BUILD.gn b/third_party/libvpx/BUILD.gn
index f2cff6bfa4c..0522aceac9c 100644
--- a/third_party/libvpx/BUILD.gn
+++ b/third_party/libvpx/BUILD.gn
@@ -333,7 +333,7 @@ if (current_cpu == "arm64") {
   # SVE is disabled for Windows due to a limitation with clang-cl-18:
   # third_party\llvm-build\Release+Asserts\lib\clang\18\include\arm_sve.h(271,1):
   # error: cannot mangle this built-in __SVInt8_t type yet
-  if (!is_win) {
+  if (!is_win && is_clang) {
     source_set("libvpx_intrinsics_sve") {
       check_includes = false
       configs -= [ "//build/config/compiler:chromium_code" ]
@@ -547,7 +547,7 @@ static_library("libvpx") {
   if (current_cpu == "arm64") {
     deps += [ ":libvpx_intrinsics_neon_dotprod" ]
     deps += [ ":libvpx_intrinsics_neon_i8mm" ]
-    if (!is_win) {
+    if (!is_win && is_clang) {
       deps += [
         ":libvpx_intrinsics_sve",
         ":libvpx_intrinsics_sve2",
diff --git a/third_party/libvpx/source/config/linux/arm64/vpx_config.h b/third_party/libvpx/source/config/linux/arm64/vpx_config.h
index 39bc1e6f092..f2c6734a035 100644
--- a/third_party/libvpx/source/config/linux/arm64/vpx_config.h
+++ b/third_party/libvpx/source/config/linux/arm64/vpx_config.h
@@ -28,8 +28,8 @@
 #define HAVE_NEON 1
 #define HAVE_NEON_DOTPROD 1
 #define HAVE_NEON_I8MM 1
-#define HAVE_SVE 1
-#define HAVE_SVE2 1
+#define HAVE_SVE 0
+#define HAVE_SVE2 0
 #define HAVE_MIPS32 0
 #define HAVE_DSPR2 0
 #define HAVE_MSA 0
