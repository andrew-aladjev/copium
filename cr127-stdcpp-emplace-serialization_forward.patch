From 320bc620c37edcb9354da31d7d3a100c343b7e2b Mon Sep 17 00:00:00 2001
From: "lauren n. liberda" <lauren@selfisekai.rocks>
Date: Thu, 27 Jun 2024 04:34:19 +0200
Subject: [PATCH] stdc++: manually initialize value for
 std::optional<T>::emplace in serialization_forward.h

workarounds https://gcc.gnu.org/bugzilla/show_bug.cgi?id=101227

Bug: 41455655
Change-Id: I6c8c67d62cd7acd63ace1b3c44607aa6524e4b4b
---
 mojo/public/cpp/bindings/lib/serialization_forward.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mojo/public/cpp/bindings/lib/serialization_forward.h b/mojo/public/cpp/bindings/lib/serialization_forward.h
index 7c357383fab19..9af6f9c79c9bc 100644
--- a/mojo/public/cpp/bindings/lib/serialization_forward.h
+++ b/mojo/public/cpp/bindings/lib/serialization_forward.h
@@ -69,7 +69,7 @@ bool Deserialize(DataType&& input, InputUserType* output, Args&&... args) {
                                             ::mojo::DefaultConstruct::Tag>) {
         output->emplace(mojo::internal::DefaultConstructTag());
       } else {
-        output->emplace();
+        output->emplace(typename InputUserType::value_type());
       }
     }
     return Deserialize<MojomType>(std::forward<DataType>(input),
