From c20607834b259e1e35095ef4fa1af0f16e54412d Mon Sep 17 00:00:00 2001
From: "lauren n. liberda" <lauren@selfisekai.rocks>
Date: Tue, 16 Apr 2024 23:39:33 +0200
Subject: [PATCH] partition_allocator: only use -Xclang options on clang

Bug: 40565911
---
 base/allocator/partition_allocator/src/partition_alloc/BUILD.gn | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/base/allocator/partition_allocator/src/partition_alloc/BUILD.gn b/base/allocator/partition_allocator/src/partition_alloc/BUILD.gn
index fbd834d0ef7..823d3137843 100644
--- a/base/allocator/partition_allocator/src/partition_alloc/BUILD.gn
+++ b/base/allocator/partition_allocator/src/partition_alloc/BUILD.gn
@@ -283,7 +283,7 @@ if (is_clang_or_gcc) {
 
   config("memory_tagging") {
     if (current_cpu == "arm64" &&
-        (is_linux || is_chromeos || is_android || is_fuchsia)) {
+        (is_linux || is_chromeos || is_android || is_fuchsia) && is_clang) {
       # base/ has access to the MTE intrinsics because it needs to use them,
       # but they're not backwards compatible. Use base::CPU::has_mte()
       # beforehand to confirm or use indirect functions (ifuncs) to select
